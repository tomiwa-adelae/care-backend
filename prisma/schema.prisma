// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String?
  refreshToken String?
  provider     String   @default("local")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  role         Role     @default(CLIENT)

  firstName String
  lastName  String

  emailVerified    Boolean   @default(false)
  resetOTP         String?
  resetOTPExpiry   DateTime?
  verificationCode String?

  gender  String?
  dob     String?
  address String?

  username String @unique

  phoneNumber String?
  city        String?
  state       String?
  country     String?

  image               String?
  isDeleted           Boolean @default(false)
  onboardingCompleted Boolean @default(false)

  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])
  tickets   Ticket[] @relation("CreatedBy")

  admin Admin?
}

model Admin {
  id        String        @id @default(uuid())
  userId    String        @unique
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  position  AdminPosition @default(ADMIN)
  user      User          @relation(fields: [userId], references: [id])
}

enum AdminPosition {
  SUPER_ADMIN
  ADMIN
  MODERATOR
}

enum Role {
  CLIENT
  ADMIN
}

model Company {
  id         String  @id @default(uuid())
  name       String
  websiteUrl String?
  rcNumber   String? // RC Number / Tax ID

  companyID String
  slug      String

  // Business Details
  industry      String?
  companySize   String? // e.g. "1-10", "11-50", "51-200", "201-500", "500+"
  companyPhone  String?
  logoUrl       String?

  // Company Address
  address  String?
  city     String?
  state    String?
  country  String?

  // Subscription Details
  selectedPlans         String[]  // Array of selected plan names
  bundleDiscount        Float     @default(0) // Discount amount applied (7.5% of subtotal)
  amount                Float     @default(0) // Final monthly amount after discount
  plan                  PlanType  @default(STARTER) // Legacy: primary plan tier
  status                SubStatus @default(ACTIVE)
  nextBilling           DateTime?
  paymentVerified       Boolean   @default(false)
  subscriptionType      String    @default("one_time") // "subscription" | "one_time"
  paystackCustomerCode  String?
  paystackSubCode       String?   // Paystack subscription code (recurring plans)

  // Relations
  users        User[]
  tickets      Ticket[]
  transactions Transaction[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

enum PlanType {
  STARTER
  GROWTH
  BUSINESS
  ENTERPRISE
}

enum SubStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
}

// 3. Ticketing System (Logic for image_f729a0.png and image_069359.png)
model Ticket {
  id          String       @id @default(uuid()) // Format: TKT-1234
  subject     String
  description String       @db.Text
  priority    Priority     @default(LOW)
  status      TicketStatus @default(OPEN)

  // Relations
  companyId   String
  company     Company @relation(fields: [companyId], references: [id])
  createdById String
  createdBy   User    @relation("CreatedBy", fields: [createdById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

// 4. Billing History (Logic for image_0707f7.png)
model Transaction {
  id          String   @id @default(uuid())
  amount      Float
  description String // e.g., "Monthly Subscription"
  status      String   @default("Paid") // Or enum
  date        DateTime @default(now())
  paystackRef String?  @unique
  type        String   @default("subscription") // "subscription" | "one_time"

  companyId String
  company   Company @relation(fields: [companyId], references: [id])
}
